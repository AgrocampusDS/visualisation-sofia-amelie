---
title: "Projet Visualisation"
author: "Sofia Chemolli & Amélie Rivet"
output: pdf_document
---

# Création du jeu de données.

Importation des packages.

```{r}
library(ggplot2)
library(maps)
library(tidyverse)
library(dplyr)
library(forcats)
library(sf)
library(ggthemes)
library(raster)
library(spData)
library(readxl)
library(flexdashboard)
```

Importation des données.

```{r}
# Espérance de vie
dta_esp <- read.csv("LifeExpectancyData.csv", stringsAsFactors = T)
dta_esp$Year <- as.factor(dta_esp$Year)
dta_esp <- dta_esp[,c(1,2,4)]


# Codes ISO3
code <- read_excel("CodeISO3.xlsx")
code$ISO3 <- as.factor(code$ISO3)


# GDP
dta_GDP <- read.csv("GDP_data.csv", sep=",", stringsAsFactors = T)
dta_GDP <- dta_GDP[,4:20]
colnames(dta_GDP) <- c("ISO3","2000", "2001", "2002","2003", "2004", "2005","2006", "2007", "2008","2009","2010", "2011", "2012","2013", "2014", "2015")

dta_GDP <- dta_GDP %>% 
  pivot_longer(c("2000", "2001", "2002","2003", "2004", "2005","2006", "2007", "2008","2009","2010", "2011", "2012","2013", "2014", "2015"))
colnames(dta_GDP)[2:3] <- c("Year", "GDP")
dta_GDP$Year <- as.factor(dta_GDP$Year)


# Dépensés par personne
dta_dep <- read.csv("Dep_data.csv", sep=",", stringsAsFactors = T)
dta_dep <- dta_dep[,4:20]
colnames(dta_dep) <- c("ISO3","2000", "2001", "2002","2003", "2004", "2005","2006", "2007", "2008","2009","2010", "2011", "2012","2013", "2014", "2015")

dta_dep <- dta_dep %>% 
  pivot_longer(c("2000", "2001", "2002","2003", "2004", "2005","2006", "2007", "2008","2009","2010", "2011", "2012","2013", "2014", "2015"))
colnames(dta_dep)[2:3] <- c("Year", "Depense")
dta_dep$Year <- as.factor(dta_dep$Year)
```

Merge des jeux de données.

```{r}
dta_esp <- left_join(dta_esp, code, by = "Country")

dta <- left_join(dta_esp, dta_dep, by = c("ISO3","Year"))

dta <- left_join(dta, dta_GDP, by = c("ISO3","Year"))
```

# Visu 1 : carte

Calcul des différences des espérance de vie.

```{r}
dta.diff <- dta %>% 
  group_by(Country) %>%
  summarise(Life.expectancy.diff = Life.expectancy[Year=='2015'] - Life.expectancy[Year=='2000']) %>%
  arrange(Life.expectancy.diff)
```

Préparation des données qui concernent la latitude et la longitude.

```{r}
world_map = map_data("world")[,-6]

colnames(world_map)[5] = "Country"

setdiff(dta$Country, world_map$Country)
world_map[world_map$Country == "Antigua",]$Country = "Antigua and Barbuda"
world_map[world_map$Country == "Barbuda",]$Country = "Antigua and Barbuda"
world_map[world_map$Country == "Bolivia",]$Country = "Bolivia (Plurinational State of)"
world_map[world_map$Country == "Brunei",]$Country = "Brunei Darussalam"
world_map[world_map$Country == "Ivory Coast",]$Country = "Côte d'Ivoire"
world_map[world_map$Country == "Cape Verde",]$Country = "Cabo Verde"
world_map[world_map$Country == "Czech Republic",]$Country = "Czechia"
world_map[world_map$Country == "Republic of Congo",]$Country = "Congo"
world_map[world_map$Country == "North Korea",]$Country = "Democratic People's Republic of Korea"
world_map[world_map$Country == "Iran",]$Country = "Iran (Islamic Republic of)"
world_map[world_map$Country == "Laos",]$Country = "Lao People's Democratic Republic"
world_map[world_map$Country == "Micronesia",]$Country = "Micronesia (Federated States of)"
world_map[world_map$Country == "South Korea",]$Country = "Republic of Korea"
world_map[world_map$Country == "Moldova",]$Country = "Republic of Moldova"
world_map[world_map$Country == "Russia",]$Country = "Russian Federation"
world_map[world_map$Country == "Syria",]$Country = "Syrian Arab Republic"
world_map[world_map$Country == "Saint Kitts",]$Country = "Saint Kitts and Nevis"
world_map[world_map$Country == "Nevis",]$Country = "Saint Kitts and Nevis"
world_map[world_map$Country == "Saint Vincent",]$Country = "Saint Vincent and the Grenadines"
world_map[world_map$Country == "Grenadines",]$Country = "Saint Vincent and the Grenadines"
world_map[world_map$Country == "North Macedonia",]$Country = "The former Yugoslav republic of Macedonia"
world_map[world_map$Country == "Trinidad",]$Country = "Trinidad and Tobago"
world_map[world_map$Country == "Tobago",]$Country = "Trinidad and Tobago"
world_map[world_map$Country == "UK",]$Country = "United Kingdom of Great Britain and Northern Ireland"
world_map[world_map$Country == "Tanzania",]$Country = "United Republic of Tanzania"
world_map[world_map$Country == "USA",]$Country = "United States of America"
world_map[world_map$Country == "Venezuela",]$Country = "Venezuela (Bolivarian Republic of)"
world_map[world_map$Country == "Vietnam",]$Country = "Viet Nam"

life.exp.map <- left_join(dta.diff, world_map, by = "Country")
n_distinct(life.exp.map[,1])
```

Compute the centroid as the mean longitude and lattitude used as label coordinate.

```{r}
position <- world_map %>%
  group_by(Country) %>%
  summarise(long = mean(long), lat = mean(lat))
```


Carte.

```{r}
ggplot(life.exp.map, aes(long, lat))+
  
  geom_polygon(aes(group = group, fill = Life.expectancy.diff), color = "black") +
  
  theme_classic() + # fond blanc
  
  xlab("") + # on enlève les labels de l'axe x 
  
  ylab("") + # on enlève les labels de l'axe y 
  
  labs(fill='Diff', # titre de la légende
       title="Différence des espérance de vie (2015-2000)" # ajout du titre
       ) +
  
  theme(axis.line = element_blank(), # enlever les axes 
        
        axis.ticks =  element_blank(), # enlever les traits des axes
        
        axis.text = element_blank(), # enlever les labels des axes
        
        plot.title = element_text(hjust = 0.5) # centrer le titre
        ) + 
  
  scale_fill_viridis_c(option = "C") +
  
  geom_text(aes(label = Country), data = position,  size = 3, hjust = 0.5)
```


# Visu 2 : trajectoires des Pays

```{r, warning=F}
# Trajectoires des espérances de vie des différents pays
ggplot(data = dta, 
       aes(x = Year, y = Life.expectancy, group = Country)) + 
  
  geom_line(aes(color = Country)) +
  
  geom_point(aes(color = Country)) +
  
  theme(legend.position = "none")  # pas de légende


# Trajectoires des GDP des différents pays
ggplot(data = dta, 
       aes(x = Year, y = round(GDP), group = Country)) + 
  
  geom_line(aes(color = Country)) +
  
  geom_point(aes(color = Country)) +
  
  theme(legend.position = "none")  # pas de légende

# Trajectoires des depenses des différents pays
ggplot(data = dta, 
       aes(x = Year, y = round(Depense), group = Country)) + 
  
  geom_line(aes(color = Country)) +
  
  geom_point(aes(color = Country)) +
  
  theme(legend.position = "none")  # pas de légende
```
Proposition Amélie.

```{r}
dta.2015 <- dta %>% 
  filter(Year=="2015")

ggplot(data = dta.2015, 
       aes(x = Depense, y = Life.expectancy))+
  geom_point()

ggplot(data = dta.2015, 
       aes(x = GDP, y = Life.expectancy))+
  geom_point()

dta.diff <- dta %>% 
  group_by(ISO3) %>%
  summarise(Life.expectancy.diff = Life.expectancy[Year=='2015'] - Life.expectancy[Year=='2000'], Depense.diff = Depense[Year=='2015'] - Depense[Year=='2000'], GDP.diff = GDP[Year=='2015'] - GDP[Year=='2000']) %>%
  arrange(Life.expectancy.diff)

ggplot(data = dta.diff, 
       aes(x = Depense.diff, y = Life.expectancy.diff))+
  geom_point()

ggplot(data = dta.diff, 
       aes(x = GDP.diff, y = Life.expectancy.diff))+
  geom_point()
```

